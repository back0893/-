# tcp粘包与分包

tcp本身是一个面对流的协议,是一串没有界限的数据,所以本质上的说tcp的粘包是一个不存在的问题.对于tcp的数据来说在发送的会依据嵌套字的缓冲区的实际情况来进行包的划分和发送,一个完成的数据可能会被拆解进行多次发送,也可能将多个小数据合成一个较大的数据包一次发送.

所以一般粘包和分包都是值具体的业务规定的数据结构.对于一个tcp的框架处理情况
![tcp处理](./protocol.png)


所以为了从tcp中获得传递来的数据,都会人为的规定数据构成,一般为 长度+数据 或者 使用固定的标志

定义 接口protocol
```
interface IProtocol interface{
    unpacket($conn);
    packet($data);
}
```
对于不同的实现,只要实现对应的数据协议就能获得数据,从而进行后续处理.
下面我实现了一个简单的php实现的tcp服务器,并且使用了协议分包
固定的头长度+数据 4个字节的数据长度+数据